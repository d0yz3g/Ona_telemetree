from typing import Dict, List, Union, Tuple, Any, Optional
import logging

# Настройка логирования
logger = logging.getLogger(__name__)

# Демо-вопросы для первоначального знакомства
DEMO_QUESTIONS = [
    {
        "id": "name",
        "text": "Как тебя зовут?",
        "type": "text"
    },
    {
        "id": "age",
        "text": "Сколько тебе лет?",
        "type": "text"
    },
    {
        "id": "birthdate",
        "text": "Какая у тебя дата рождения? (формат: ДД.ММ.ГГГГ)",
        "type": "text"
    },
    {
        "id": "birthplace",
        "text": "Где ты родился/родилась? (город, страна)",
        "type": "text"
    },
    {
        "id": "timezone",
        "text": "В каком часовом поясе ты находишься? (например, UTC+3 для Москвы)",
        "type": "text"
    }
]

# Тест 2.0 - 34 вопроса из файла test2.0 с вариантами ответов и интерпретациями
VASINI_QUESTIONS = [
    {
        "id": "vasini_1",
    "text": "Что ты чувствуешь, когда смотришь в своё будущее?",
    "type": "choice",
    "options": {
        "A": "Воодушевление. Будущее манит как архитектура нового мира",
        "B": "Напряжение. Я не хочу думать о том, чего ещё нет",
        "C": "Конкретику. Я мыслю шагами, а не образами",
        "D": "Привязанность к настоящему. Я живу здесь и сейчас"
    },
    "interpretations": {
        "A": "Ты действуешь из будущего, а не из настоящего. Ты не фантазируешь — ты проектируешь. Ты не ждёшь вдохновения — ты уже живёшь в мире, который другие только начинают воображать. Это встроенная функция прогностики, а не идеализм. Твоё «завтра» — это топливо «сегодня».",
        "B": "У тебя защитный фильтр от неопределённости. Будущее кажется слишком зыбким — и ты предпочитаешь реальные точки опоры. Это не слабость, а адаптивный механизм к хаосу. Но он отключает дальнее зрение, если не перезагрузить внутреннюю безопасную среду.",
        "C": "У тебя мышление системного исполнителя. Не образы, а действия. Не фантазии, а модели. Ты способна строить мосты — но только если знаешь, куда они ведут. Это фокус на процессе, а не на горизонте. Это инженер внутри архитектора.",
        "D": "У тебя дом в настоящем. Ты живёшь моментом и не ускользаешь в симуляции будущего. В этом сила, если ты создаёшь глубину здесь. Но это может стать якорем, если избежать будущего — это способ спрятаться от необходимости роста."
    }
},
{
    "id": "vasini_2",
    "text": "Как в тебе рождаются идеи?",
    "type": "choice",
    "options": {
        "A": "Я скачиваю их как поток — будто через меня кто-то говорит",
        "B": "Они приходят через образы, метафоры, цветовые связи",
        "C": "Я вижу структуры, которые соединяют несвязанное",
        "D": "Я беру идею из воздуха и превращаю в систему"
    },
    "interpretations": {
        "A": "Ты — приёмник, не автор. У тебя нет «я придумала» — у тебя «я услышала». Ты входишь в канал, а идеи протекают сквозь. Ты — транслятор. Если перекрыть поток — система падает. Сила в доверии без контроля.",
        "B": "Ты синестетик смыслов. Идеи в тебе не из логики — они из образов, цвета, ощущения. Ты видишь мысль в форме. Это не мышление — это внутренний дизайнер смыслов. Ты переводишь абстрактное в чувственное.",
        "C": "Ты архитектор связей. Твоя сила — объединять то, что не соединяется. Ты находишь мост между полюсами. Ты не придумываешь — ты распознаёшь. Это идеация высокого уровня: не “создаю”, а “вижу, как всё работает вместе”.",
        "D": "Ты визионер-реализатор. Ты не любишь просто идею — тебе нужно её закрепить. Построить. Проверить. Ты не романтик, а синтезатор систем: видишь импульс — превращаешь в механизм. Это редкое сочетание мечты и процесса."
    }
},
{
    "id": "vasini_3",
    "text": "Как ты ощущаешь своё влияние на других людей?",
    "type": "choice",
    "options": {
        "A": "Я легко беру центр внимания, если нужно",
        "B": "Я ощущаю, что пространство меня слышит — даже в молчании",
        "C": "Я не люблю влиять — я лучше отойду",
        "D": "Я влияю через эмоции, вовлечение, харизму"
    },
    "interpretations": {
        "A": "У тебя волевая структура влияния. Ты знаешь, когда нужно выйти в центр — и делаешь это. Это не агрессия, а решимость. Ты умеешь взять на себя пространство, если цель важнее скромности.",
        "B": "Ты управляешь состоянием, а не словами. Твоё влияние — в частоте. Люди перенастраиваются от твоего взгляда, паузы, жеста. Ты не доказываешь — ты настраиваешь поле. Это не лидерство, это модуль реальности.",
        "C": "Ты антивлияние. Уход — тоже форма власти. Твоя стратегия — мягкое невмешательство, позволяющее другим проявиться. Это сила пустоты, которая может быть лечебной — но и изоляционной.",
        "D": "Ты харизматичный драйвер. Эмоция, голос, движение — ты входишь и перехватываешь внимание. Важно помнить: это канал. Он работает, если в нём смысл. Без смысла он истощает. Ты — факел, но не для всех комнат."
    }
},
{
    "id": "vasini_4",
    "text": "Когда ты чувствуешь, что живёшь?",
    "type": "choice",
    "options": {
        "A": "Когда узнаю новое и сразу интегрирую",
        "B": "Когда есть глубокая цель",
        "C": "Когда что-то меняется и я адаптируюсь",
        "D": "Когда я внутри потока и всё работает без усилия"
    },
    "interpretations": {
        "A": "Твоё топливо — эволюция. Не “учиться”, а меняться через знание. Ты — живой R&D-отдел. Ты не можешь не расти. Если нет движения — начинается деградация. Учёба — это форма дыхания.",
        "B": "Ты не растёшь ради роста. Тебе важна миссия, в которую вшит рост. Без вектора — всё бессмысленно. Ты учишься, если знаешь, куда это ведёт. В противном случае — отворачиваешься.",
        "C": "Ты гибкий организм. Твоя сила — в приспособлении без потери сути и внутренней правды. Ты — модульный интеллект, который обновляется через ситуацию. Изменения для тебя не угроза, а среда апгрейда.",
        "D": "Ты в росте, когда в потоке. Твоя обучаемость — не сознательная. Это происходит, когда ты на месте, в теле, в деле. Тебе не нужен учитель — тебе нужна правильная частота и момент."
    }
},
{
    "id": "vasini_5",
    "text": "Что двигает тобой в работе и жизни?",
    "type": "choice",
    "options": {
        "A": "Результат и признание",
        "B": "Глубокое “зачем”",
        "C": "Возможность изменить что-то вокруг",
        "D": "Возможность постоянно открывать новое"
    },
    "interpretations": {
        "A": "Тебе нужен отклик. Ты действуешь на топливе внешнего результата, внимания, меток успеха. Это даёт импульс, но может осушить, если исчезнет внешний зритель.",
        "B": "Тебя не интересует форма. Если нет смысла — ты не идёшь. Даже если проект велик, имя громко, деньги большие. Если нет внутреннего “зачем” — тебя нет. Твоя система — мотивированная смыслом.",
        "C": "Ты — корректор мира. Тебя двигает не цель, а воздействие. Ты не зритель — ты хочешь влиять на поле, на сознание, на структуру. Это не амбиция, это форма участия.",
        "D": "Ты — исследователь, не результатник. Твоя ценность — в процессе открытий. Ты не к чему-то идёшь — ты настроена на постоянное “узнавание”. Это даёт свежесть, но требует внешней поддержки структуры."
    }
},
{
    "id": "vasini_6",
    "text": "Как ты определяешь, что правильно для тебя?",
    "type": "choice",
    "options": {
        "A": "Я чувствую это как щелчок внутри — и больше не сомневаюсь",
        "B": "Я анализирую: если логика не проваливается — решение моё",
        "C": "Я иду за откликом тела, а не головы",
        "D": "Я смотрю на реакции других и сверяю по ним"
    },
    "interpretations": {
        "A": "У тебя встроенный навигатор. Ты не споришь с собой. Когда решение созрело — ты чувствуешь «да». Это не интуиция, это мгновенная настройка на внутреннюю правду, как будто в теле загорается сигнал.",
        "B": "Ты доверяешь структуре разума. Ты не принимаешь решений вслепую. Тебе важна архитектура логики — если она работает, ты идёшь. Это делает тебя надёжной , но может затормозить импульс принятия решений.",
        "C": "Ты опираешься на телесную правду. Твоё тело знает раньше ума. Ты считываешь напряжение, зажим, лёгкость, открытие — и по этому строишь маршрут. Это эмпирическая интуиция, встроенная в нервную систему.",
        "D": "Ты — социальное зеркало. Тебе важно видеть, как отражается решение в поле. Это не зависимость — это проверка реальности через коллективный резонанс. Если мир не отзывается — ты смотришь глубже."
    }
},
{
    "id": "vasini_7",
    "text": "Как ты взаимодействуешь с новой информацией?",
    "type": "choice",
    "options": {
        "A": "Я вбираю всё подряд — вдруг пригодится",
        "B": "Я беру только то, что сразу встаёт в систему",
        "C": "Я записываю, сортирую, структурирую",
        "D": "Я ничего не сохраняю — если важно, запомнится"
    },
    "interpretations": {
        "A": "Ты — носительница разных кодов. Ты не фильтруешь на входе — ты накапливаешь мир как архив. Это делает тебя живой библиотекой, но может перегрузить внимание.",
        "B": "У тебя встроенный смысловой фильтр. Ты чувствуешь, какая информация вибрирует с твоей системой. Остальное отсекаешь. Ты не учишься много — ты учишься точно.",
        "C": "Ты — организатор знаний. Ты не просто воспринимаешь — ты сразу выстраиваешь структуру. У тебя вся информация идёт в архитектуру сознания: ты не хранишь её «просто так».",
        "D": "Ты живёшь в доверии к памяти. Ты не коллекционерка знаний — ты позволяешь важному остаться. Это минималистическая модель познания, где всплывает только то, что нужно сейчас."
    }
},
{
    "id": "vasini_8",
    "text": "Как ты обычно ведёшь себя при встрече с незнакомыми людьми?",
    "type": "choice",
    "options": {
        "A": "Я легко открываюсь, вовлекаю, завожу разговор",
        "B": "Я сначала чувствую атмосферу — и только потом включаюсь",
        "C": "Я держу дистанцию — не люблю поверхностных контактов",
        "D": "Если чувствую взаимность, могу стать очень вовлечённым"
    },
    "interpretations": {
        "A": "Ты харизматичный инициатор. Тебе легко вступать в контакт — ты магнит первого касания. Ты входишь в поле и зажигаешь. Но если неосторожно — можешь перегореть или увлечься не тем.",
        "B": " Ты чувствуешь пространство до слова. Ты не вступаешь в контакт, пока не считала, что «пора». Ты осторожна не из страха — ты просто настроена глубже.",
        "C": "Ты защищаешь внутренний контур. Ты не «открытая». Ты точная. Ты не любишь лишнее движение, потому что ценишь глубину. Для тебя контакт — не игра, а соединение.",
        "D": "У тебя резонансная модель включения. Твоё вовлечение зависит от качества связи. Если есть честность, тепло, интерес — ты раскрываешься до дна. Если нет — ты спокойна и недоступна."
    }
},
{
    "id": "vasini_9",
    "text": "Что ты делаешь, когда чувствуешь, что назревает конфликт?",
    "type": "choice",
    "options": {
        "A": "Вмешиваюсь, чтобы восстановить правду",
        "B": "Сглаживаю и стараюсь гармонизировать",
        "C": "Ухожу — я не про это",
        "D": "Вижу, кто создаёт напряжение, и наблюдаю"
    },
    "interpretations": {
        "A": "У тебя честность как действие. Ты не избегаешь — ты восстанавливаешь баланс через правду. Даже если будет больно. Ты не борешься — ты обнажаешь суть.",
        "B": "Ты медиатор пространства. Тебе важно, чтобы поле не распадалось. Ты умеешь свести, выровнять, заземлить. Твоя цель — не победить, а сохранить систему.",
        "C": "Ты не тратишь энергию на разрушение. Если в поле диссонанс — ты выходишь. Не от страха, а от прагматизма. Ты ценишь внутренний покой больше, чем доказывание.",
        "D": "Ты наблюдаешь источник. Ты не входишь в ссору — ты смотришь, кто двигает процесс. У тебя аналитический подход к конфликту: ты считываешь механику конфликта, а не эмоции."
    }
},
{
    "id": "vasini_10",
    "text": "Как ты обычно начинаешь что-то новое?",
    "type": "choice",
    "options": {
        "A": "Сразу бросаюсь в движение — разберусь по ходу",
        "B": "Жду вдохновения или внутреннего импульса",
        "C": "Планирую и только потом двигаюсь",
        "D": "Лучше в команде — коллективный запуск эффективнее"
    },
    "interpretations": {
        "A": "Ты — катализатор старта. Для тебя главное — начать, а потом уже идёт импровизация. Ты не ждёшь идеального момента. Ты умеешь сдвигать застой.",
        "B": "Ты действуешь из глубинного сигнала. Тебе не нужен дедлайн. Тебе нужен внутренний щелчок. Без него — ты не идёшь. С ним — ты безостановочна.",
        "C": "Ты инженер начала. У тебя всё выстроено. Без структуры ты не стартуешь. Твоя сила — в подготовке. Но если застрянешь в планировании — можешь не пойти вовсе.",
        "D": "Ты включаешься от коллективной динамики. Ты не одинокий стартер. Тебе важна энергия группы. В ней ты находишь тонус и скорость. Это твоя пусковая система."
    }
},
{
    "id": "vasini_11",
    "text": "Как ты реагируешь, когда берёшь на себя обещание?",
    "type": "choice",
    "options": {
        "A": "Выполняю, даже если стало тяжело — слово есть слово",
        "B": "Беру обязательства, только если точно уверен",
        "C": "Стараюсь избегать обещаний — они сковывают",
        "D": "Отношусь гибко: если меняется ситуация, пересматриваю"
    },
    "interpretations": {
        "A": "У тебя клятва встроена в характер. Ты не сдаёшь назад. Если пообещала — несёшь. Это твой этический код: внутреннее «да» стоит больше, чем внешние обстоятельства.",
        "B": "Ты не даёшь слово на эмоциях. Ты сначала сканируешь ресурс, внутреннее согласие, прогноз. Это делает тебя надёжным партнёром, потому что ты входишь только в то, что можешь держать.",
        "C": "Ты не из мира контрактов. Ты движешься по внутреннему ритму и не хочешь быть связана внешними обещаниями. Это может быть силой свободы — но и зоной ухода от вызова.",
        "D": "У тебя адаптивная модель ответственности. Ты умеешь менять решения, если изменилась реальность. Ты не слепо держишься за слово — ты сверяешь с полем, ситуацией, своей честностью."
    }
},
{
    "id": "vasini_12",
    "text": "Когда ты общаешься с человеком, что ты замечаешь в первую очередь?",
    "type": "choice",
    "options": {
        "A": "Я чувствую, кем он может стать",
        "B": "Я считываю, как он мыслит, действует, реагирует",
        "C": "Я вижу, как он влияет на поле/группу",
        "D": "Я просто смотрю, кто он есть сейчас"
    },
    "interpretations": {
        "A": "Ты — активатор чужого роста. Ты видишь не форму, а возможность. Ты распознаёшь силу, даже если она в спящем режиме — и можешь стать триггером её пробуждения.",
        "B": "У тебя рентген мышления. Ты понимаешь, как человек устроен изнутри — что им движет, где у него точки перегруза, что даёт энергию. Это делает тебя чётким диагностом.",
        "C": "Ты — стратег групповой динамики. Тебя интересует не человек сам по себе, а его вклад в систему, энерго-влияние. Ты как бы видишь людей как векторы, не как личности.",
        "D": "Ты живёшь в настоящем контакте. Тебе не нужно «кем он может стать» — ты воспринимаешь его прямо сейчас. Это даёт чистоту, но может пропустить потенциал, если не смотреть глубже."
    }
},
{
    "id": "vasini_13",
    "text": "Что помогает тебе концентрироваться на задаче?",
    "type": "choice",
    "options": {
        "A": "Вдохновение и внутренний отклик",
        "B": "Структура: список, таймер, расписание",
        "C": "Внешний дедлайн или партнёр",
        "D": "Пространство и ритуал — атмосфера важнее всего"
    },
    "interpretations": {
        "A": "У тебя эмоциональная фокусировка. Ты не можешь концентрироваться на том, что не звучит. Тебе нужен внутренний резонанс, тогда ты входишь в туннель.",
        "B": "Ты — мастер систем. Тебе нужно, чтобы всё лежало по местам, был тайминг, структура, чеклист. Тогда ты собрана, стабильна и точена.",
        "C": "Ты включаешься от давления или сопричастности. Ты реагируешь на ответственность перед другим или ограниченное время. Это активатор — но без него фокус может расплыться.",
        "D": "Твоё внимание зависит от окружения. Тебе нужно войти в атмосферу: музыка, запах, освещение, символ, точка входа. Без ритуала — вход затруднён, с ним — ты в силе."
    }
},
{
    "id": "vasini_14",
    "text": "Как ты воспринимаешь порядок в системах?",
    "type": "choice",
    "options": {
        "A": "Я создаю свои правила — так эффективнее",
        "B": "Я люблю чёткие рамки — в них легко работать",
        "C": "Я соблюдаю общие правила, если они разумны",
        "D": "Я игнорирую правила, если они мешают сути"
    },
    "interpretations": {
        "A": "Ты архитектор собственных кодов. Тебе нужна система, но она должна быть твоей. Ты строишь порядок, исходя из внутренней логики, а не из внешней инструкции.",
        "B": "Ты работаешь через структуру. У тебя есть внутренняя тяга к предсказуемости. Ты расцветаешь в чётких контурах. Это твой способ держать фокус и снижать тревожность.",
        "C": "Ты гибкая рационалистка. Ты не отрицаешь правила, но сверяешь с реальностью. Если работают — следуешь. Если абсурдны — модифицируешь.",
        "D": "У тебя приоритет — смысл. Если правило не ведёт к сути, ты его сбрасываешь. Ты не подчиняешься структуре ради структуры. Для тебя важно, чтобы всё служило цели, а не форме."
    }
},
{
    "id": "vasini_15",
    "text": "Что для тебя означает «достичь»?",
    "type": "choice",
    "options": {
        "A": "Сделать максимально хорошо — и довести до совершенства",
        "B": "Завершить задачу — и двигаться дальше",
        "C": "Ощутить, что был рост, развитие",
        "D": "Вдохновить других и запустить волну"
    },
    "interpretations": {
        "A": "Ты — идеалистка. Ты не можешь отпустить, пока всё не выверено, отточено, кристаллизовано. Это делает тебя мастером качества — и заложником перфекционизма.",
        "B": "Ты движешься по траектории действия. Тебе важно закрыть цикл. Не зависнуть. Ты оцениваешь результат в завершении. Ты спринтерша. Главное для тебя - дойти до финиша.",
        "C": "Для тебя достижение — внутренний прирост. Ты смотришь не на «внешнее», а на то, что в тебе изменилось. Ты развиваешься сквозь результат, а не в нём.",
        "D": "Ты запускаешь эффект. Для тебя результат — волна, которую ты начала. Ты не просто достигаешь — ты двигаешь других через свой процесс."
    }
},
{
    "id": "vasini_16",
    "text": "Что для тебя означает учиться?",
    "type": "choice",
    "options": {
        "A": "Это моя форма жизни. Я не могу не развиваться",
        "B": "Это инструмент: учусь, если есть цель",
        "C": "Только если интересно — иначе отключаюсь",
        "D": "Я люблю наблюдать, как учатся другие, а потом делаю по-своему"
    },
    "interpretations": {
        "A": "Ты растёшь, как дышишь. Учёба — не процесс, а внутренняя функция твоей личности. Без движения ты вянешь. Тебе не нужны преподаватели — ты сама себе поле обучения. Даже ошибка — ресурс, даже пауза — апгрейд.",
        "B": "Ты — практик эффективности. Учишься тогда, когда видишь зачем. Не из любопытства, а из вектора. Если не применимо — не задерживается. У тебя ум в форме алгоритма: «если Х, то интеграция».",
        "C": "Твоя система работает от страсти. Если нет огня — процесс не запускается. Ты не любишь «нужно», ты входишь в «хочу». Это делает тебя яркой, глубокой исследовательницей, но может мешать долгому пути без искры.",
        "D": "Ты учишься через наблюдение и внутреннее воспроизведение. Тебе не нужен класс — тебе нужно видеть процесс, переварить, настроиться. У тебя не внешняя учёба — у тебя внутреннее перевоплощение через пример."
    }
},
{
    "id": "vasini_17",
    "text": "Когда ты чувствуешь уверенность?",
    "type": "choice",
    "options": {
        "A": "Когда знаю, что подключена к себе и потоку",
        "B": "Когда вижу результат — действия укрепляют",
        "C": "Когда чувствую, что есть поддержка извне",
        "D": "Когда я спонтанна и в моменте"
    },
    "interpretations": {
        "A": "Твоя опора — в соединённости. Не важно, есть ли план, поддержка или инструкция — если ты в своей частоте, ты несокрушима. Это внутренняя калибровка: ты не убеждаешь себя — ты возвращаешься в себя.",
        "B": "Ты получаешь силу через реализацию. Сделала — укрепилась. Применила — утвердилась. Для тебя действие — это якорь уверенности. Без движения — беспокойство.",
        "C": "Ты строишь на связи. Если чувствуешь поддержку, взгляд, отклик — ты раскрываешься. Ты не зависишь от других, но взлетаешь, когда чувствуешь, что не одна.",
        "D": "Уверенность приходит в потоке. Когда ты не думаешь, не держишься — а идёшь в моменте, телом, голосом, спонтанностью. Твоё «я» живёт в настоящем, не в доказательствах."
    }
},
{
    "id": "vasini_18",
    "text": "Что ты замечаешь в людях сразу?",
    "type": "choice",
    "options": {
        "A": "Чем они могут стать",
        "B": "Как они себя ведут и мыслят",
        "C": "Как они влияют на поле",
        "D": "Что в них уникального"
    },
    "interpretations": {
        "A": "Ты считываешь потенциал. Ты не про «сейчас». Ты — про возможное, раскрывающееся, предчувствованное. Ты как будто видишь будущую версию человека — и иногда страдаешь, если он не готов к ней.",
        "B": "Ты наблюдаешь схему. Тебе важны поведенческие паттерны. Ты читаешь: как говорит, что повторяет, где напряжение. Ты как будто раскладываешь поведение на слои.",
        "C": "Ты чувствуешь их влияние на систему. Ты не оцениваешь лично. Ты чувствуешь поле, как человек его изменяет. Для тебя человек — не образ, а узел в сети.",
        "D": "Ты смотришь через призму уникальности. В каждом ты ощущаешь неповторимую вибрацию. Ты как будто считываешь «аромат» человека. Ты не строишь стратегию — ты вкушаешь суть."
    }
},
{
    "id": "vasini_19",
    "text": "Как ты ощущаешь мир вокруг себя?",
    "type": "choice",
    "options": {
        "A": "Всё взаимосвязано. Даже мелочи — часть большого узора",
        "B": "Иногда вижу синхронии, но не придаю им особого значения",
        "C": "Всё случайно, смысл мы создаём сами",
        "D": "Мир устроен как поле, и я в нём — участница, не наблюдательница"
    },
    "interpretations": {
        "A": "Ты живёшь в орнаменте связей. Для тебя ничего не отдельно. Ты ощущаешь связи, даже если их не видно. Ты — часть живой системы, и ты её чувствуешь кожей.",
        "B": "Ты допускаешь смысл, но не зависишь от него. Ты не ищешь магии во всём, но если что-то выделяется — ты отмечаешь. Твоя система рационально-открытая.",
        "C": "Ты строишь мир из пустоты. Ты не ждёшь, что кто-то раскроет смысл — ты сама его создаёшь. Тебе важна свобода, не заданность. Это делает тебя создательницей, но может оторвать от потока.",
        "D": "Ты не зритель — ты клетка в ткани. Ты не объясняешь поле — ты в нём живёшь. Ты не про «почему» — ты про «как двигается». У тебя телесная связь с реальностью."
    }
},
{
    "id": "vasini_20",
    "text": "Что двигает тобой, когда нужно включиться в задачу?",
    "type": "choice",
    "options": {
        "A": "Я включаюсь, когда понимаю, что важно",
        "B": "Меня зажигает цель, за которой стоит что-то большее",
        "C": "Если знаю, что это будет иметь результат",
        "D": "Когда чувствую поддержку и включённость других"
    },
    "interpretations": {
        "A": "У тебя функциональная этика. Если ты знаешь, зачем это сейчас, ты включаешься. Твоя энергия — про важность, не про эмоции. Ты не бросаешься — ты входишь, когда понимаешь смысл.",
        "B": "Твоя мотивация — высокая цель. Если ты чувствуешь, что за задачей стоит миссия, влияние, изменение — ты загораешься. Для тебя задача без контекста — пустая оболочка.",
        "C": "Тебе важен результат. Ты включаешься, когда видишь, что это даст. Конкретика, эффект, сдвиг. Без этого — расфокус.",
        "D": "Ты включаешься через сопричастность. Ты — соавторка, не солистка. Твоя энергия — в поле других людей. Без контакта — нет огня. В группе — ты движок."
    }
},
{
    "id": "vasini_21",
    "text": "Как ты реагируешь, когда сталкиваешься с поломкой, ошибкой или нарушением?",
    "type": "choice",
    "options": {
        "A": "Сразу хочу исправить — не могу смотреть на несовершенство",
        "B": "Сначала определяю, моё ли это — не лезу в чужое",
        "C": "Я восстанавливаю, если есть потенциал нового",
        "D": "Иногда ухожу, если вижу, что система мертва"
    },
    "interpretations": {
        "A": "У тебя встроен механизм восстановления. Ты не просто решаешь проблемы — ты исправляешь, чтобы восстановить целостность. У тебя рука тянется, как только видишь сбой. Это делает тебя целительницей систем.",
        "B": "Ты включаешься из внутреннего “моё/не моё”. Если чувствуешь отклик — входишь глубоко и точно. Но не входишь «просто потому что можешь». Это зрелая стратегия распределения энергии.",
        "C": "Ты — преобразователь. Для тебя чинить ради чинить — не работает. Но если ты видишь шанс эволюции, ты входишь и превращаешь поломку в возможность. Это сила алхимии, а не ремонта.",
        "D": "Ты не оживляешь мёртвое. Если система не хочет жить — ты не заставляешь её. Ты не из тех, кто «будет до конца». Ты знаешь, когда выйти, чтобы не потерять себя."
    }
},
{
    "id": "vasini_22",
    "text": "Как ты ощущаешь себя в группе или системе?",
    "type": "choice",
    "options": {
        "A": "Я замечаю тех, кто на периферии, и стараюсь их вовлечь в общение",
        "B": "Я принимаю всех, но держу здоровую дистанцию",
        "C": "Я выбираю, с кем общаться — не всем нужно быть внутри",
        "D": "Если чувствую, что кто-то страдает от изоляции, не могу пройти мимо"
    },
    "interpretations": {
        "A": "Ты включаешь границы в общество. Ты видишь тех, кого не видно. Ты — включающая сила, создающая пространство для всех. ",
        "B": "Ты создаёшь принятие без растворения. Ты не разделяешь людей на «своих и чужих», но и не вбираешь всех в зону близости. Ты держишь пространство, в котором можно быть собой.",
        "C": "У тебя точечный контакт. Ты не массовая. Ты избирательна в энергии. У тебя нет вины за невключение — у тебя настройка на глубину, а не количество.",
        "D": "Ты чувствительна к боли отделения. Ты не можешь пройти мимо человека, выпавшего из группы. Ты не социализируешь — ты возвращаешь. Это эмпатия, ставшая действием."
    }
},
{
    "id": "vasini_23",
    "text": "Как ты обычно принимаешь важные решения?",
    "type": "choice",
    "options": {
        "A": "Жду, пока созреет чувство “всё — время пришло”",
        "B": "Перепроверяю возможные риски и последствия",
        "C": "Советуюсь с теми, кто ближе к теме",
        "D": "Принимаю решение резко, когда чувствую внутренний поворот"
    },
    "interpretations": {
        "A": "У тебя биоритмическое принятие. Ты не толкаешь себя. Ты ждёшь момента, когда внутренний механизм решит за тебя. Это не оттяжка — это органическая стратегия выбора.",
        "B": "У тебя аналитическая защита. Ты смотришь на возможные сбои. Не потому, что боишься — а потому что видишь дальше. Ты действуешь, когда вероятность урона минимальна.",
        "C": "Ты подключаешь коллективное мышление. Ты не передаёшь ответственность — ты строишь поле навигации. Ты не закрыта — ты открыта к сигналам. Но итог — всегда твой.",
        "D": "У тебя импульсная природа поворота. Ты можешь долго молчать — а потом резко выйти. Когда чувствуешь поворот внутри — всё включается и идёшь. Это не хаос, это собранный момент действия."
    }
},
{
    "id": "vasini_24",
    "text": "Что даёт тебе энергию двигаться вперёд в проекте?",
    "type": "choice",
    "options": {
        "A": "Осознание, что я создала что-то значимое",
        "B": "Сама реализация — быть в движении, не останавливаться",
        "C": "Признание, внимание, результат",
        "D": "Глубина процесса — даже если его никто не увидит"
    },
    "interpretations": {
        "A": "Ты движешься через вклад. Для тебя важно не просто сделать — а оставить след. В тебя встроена система значимости. Без неё дело гаснет, как свеча без кислорода.",
        "B": "Ты — двигатель процесса. Тебе не нужно ждать вдохновения или награды. Ты включаешься от самого действия. Движение — твой воздух. Без него ты замираешь.",
        "C": "Ты включаешься от света других. Если видишь, что это заметили, что это помогло, что это оценивается — твоя система включается. Ты не живёшь ради лайков, но рефлексия от мира тебя усиливает.",
        "D": "Тебе важна внутренняя глубина. Ты можешь делать в тени, в тишине, в одиночестве. Ты не требуешь признания, потому что для тебя процесс — уже результат. Твоё дело — не выставка, а алхимия."
    }
},
{
    "id": "vasini_25",
    "text": "Что для тебя значит быть значимой?",
    "type": "choice",
    "options": {
        "A": "Знать, что то, что я делаю, несёт смысл",
        "B": "Видеть, что мой труд замечен и признан",
        "C": "Чувствовать, что я влияю, даже молча",
        "D": "Быть в резонансе с собой, вне оценки"
    },
    "interpretations": {
        "A": "Твоя ценность — в смысле. Если дело пустое — ты исчезаешь. Если в нём миссия — ты горишь. Для тебя быть значимой = быть связанной с высоким зачем.",
        "B": "Твоё зеркало — в глазах других. Ты не живёшь ради признания, но ты цветёшь, когда тебя замечают. Это не эгоизм — это твоя социальная сенсорика.",
        "C": "Ты влияешь полем. Даже если молчишь — ты меняешь. Твоя сила не в звуке, а в частоте. Ты не агитаторка — ты настройщица пространства.",
        "D": "Твоя значимость — в целостности. Когда ты внутри себя — ты есть. Ты не измеряешься извне. Ты не нуждаешься в подтверждении, ты просто присутствуешь."
    }
},
{
    "id": "vasini_26",
    "text": "Как ты действуешь в условиях неопределённости или потенциального риска?",
    "type": "choice",
    "options": {
        "A": "Я анализирую всё заранее — и только потом иду",
        "B": "Доверяю интуиции и ощущению поля",
        "C": "Пробую, а потом корректирую по ходу",
        "D": "Если чувствую «щелчок» — решаюсь резко, без лишних проверок"
    },
    "interpretations": {
        "A": "У тебя защитная аналитика. Ты не бросаешься — ты считываешь. Риск для тебя не страшен, если понятен. Твоя сила — в точности, а не в скорости.",
        "B": "Ты ориентируешься на невидимое. Ты слушаешь не разум, а настроение пространства. Это даёт тебе преимущество, когда логика бессильна. Твоя интуиция — профессиональный инструмент.",
        "C": "У тебя гибкая реализация. Ты не ждёшь стопроцентной уверенности. Ты действуешь и калибруешь по ходу. Это делает тебя живой, эффективной, но требует крепкой рефлексии.",
        "D": "У тебя есть внутренний тумблер. Ты можешь быть тихой, взвешенной — и в одну секунду сказать «да». Ты живёшь в ощущении момента. Это прыжок, но всегда изнутри, не снаружи."
    }
},
{
    "id": "vasini_27",
    "text": "Когда ты чувствуешь, что пространство правильное?",
    "type": "choice",
    "options": {
        "A": "Когда в нём все чувствуют себя комфортно",
        "B": "Когда всё выстроено и ясно",
        "C": "Когда чувствуется лёгкость и принятие",
        "D": "Когда можно быть собой без объяснений"
    },
    "interpretations": {
        "A": "Ты чувствительная к включённости. Если кто-то остался «вне» — ты ощущаешь искажение. Гармония для тебя — это не порядок, а присутствие всех.",
        "B": " Ты — архитекторка структуры. Ты чувствуешь комфорт, когда всё имеет место, логику, контур. У тебя эстетика точности. Твоя гармония — это симметрия ума.",
        "C": "Тебе важна мягкость и доступ. Пространство правильно, если в нём легко дышать. У тебя тактильная гармония: по свету, голосу, интонации. Ты создаёшь «живые комнаты».",
        "D": "Твоя гармония — в свободе быть. Тебе важно, чтобы можно было не быть кем-то. Не играть. Не оправдываться. Если это есть — ты расслаблена. Если нет — ты сжимаешься."
    }
},
{
    "id": "vasini_28",
    "text": "Как ты чаще всего влияешь на других?",
    "type": "choice",
    "options": {
        "A": "Через своё состояние — даже если молчу",
        "B": "Через слово, голос, речь",
        "C": "Через пример: я делаю — и это вдохновляет",
        "D": "Через поддержку и эмпатию"
    },
    "interpretations": {
        "A": "Ты влияешь из поля. Твоё состояние настраивает реальность вокруг. Твоя улыбка, тишина, взгляд — работают как настройки. Ты влияешь не за счёт действия, а за счёт энергии.",
        "B": "Ты — резонаторка речи. У тебя голос убеждения, слово-магнит, речь — как вектор. Ты перекодируешь поле через слово. Если не говоришь — мир теряет координату.",
        "C": "Ты — живой аргумент. Ты не объясняешь — ты демонстрируешь. Твой способ влиять — это быть собой, идти, делать. И другие включаются.",
        "D": "Ты — катализатор безопасности. Рядом с тобой можно быть уязвимой — и не бояться. Это не просто влияние — это permission: «ты можешь быть собой»."
    }
},
{
    "id": "vasini_29",
    "text": "Что помогает тебе не теряться в сложных ситуациях?",
    "type": "choice",
    "options": {
        "A": "Система ценностей — она как карта",
        "B": "Чувство, что я не одна",
        "C": "Опора на прошлые победы",
        "D": "Умение быстро адаптироваться"
    },
    "interpretations": {
        "A": "У тебя встроенная этическая навигация. Когда всё рушится — ты возвращаешься к смыслу, к своей внутренней системе координат. И ты снова видишь путь.",
        "B": "Ты выстраиваешься через контакт. Если чувствуешь, что рядом кто-то есть, ты не упадёшь. Ты социально устойчива, не потому что зависима — а потому что связана.",
        "C": "Твоя сила — в памяти достижений. Ты возвращаешь себе уверенность через то, что уже получилось. Это твой внутренний трекер доказательств: «я уже шла — я могу снова».",
        "D": "Ты модульная. Ситуация меняется — и ты меняешься с ней. Не сражаешься, не застываешь — перестраиваешься, сохраняя суть. У тебя адаптивная стойкость."
    }
},
{
    "id": "vasini_30",
    "text": "Когда ты чувствуешь, что ты в полной силе?",
    "type": "choice",
    "options": {
        "A": "Когда я не отвлекаюсь и полностью погружаюсь",
        "B": "Когда ощущаю вдохновение и красоту",
        "C": "Когда чувствую, что это важно — тогда раскрываюсь",
        "D": "Когда я не ограничена — формат открытый, поле свободнос"
    },
    "interpretations": {
        "A": "Твоё творчество — в фокусе. Ты заходишь в туннельное состояние, и реальность уходит. Ты создаёшь из глубины, без шума. Для этого тебе нужен коридор внимания.",
        "B": "Ты творишь из эстетики. Красота, форма, свет, звук — если это есть, ты включаешься. Ты не создаёшь насильно. Ты цветёшь в настроенном пространстве.",
        "C": "Твоё вдохновение — в значении. Если чувствуешь, что создаёшь ради чего-то важного — ты входишь. Суть — не в креативе, а в миссии.",
        "D": "Ты создаёшь в свободе.Если формат сжимает — ты уходишь. Тебе нужно поле, где нет рамки, где можно менять, импровизировать, дышать. Тогда ты становишься источником."
    }
},
{
    "id": "vasini_31",
    "text": "Что придаёт значимость тому, что ты делаешь?",
    "type": "choice",
    "options": {
        "A": "Влияние — когда мой вклад чувствуется в жизни других",
        "B": "Признание — когда это замечают",
        "C": "Внутренний отклик — когда я знаю, что это правильно",
        "D": "Масштаб — когда я чувствую, что это больше меня"
    },
    "interpretations": {
        "A": "Ты вкладываешься, чтобы изменить. Тебе важно не просто делать, а двигать мир, людей, поле. Это не эго — это вложение силы в след.",
        "B": "Ты расцветаешь от отражения. Когда твой труд не остаётся в тени, ты входишь в поток. Не потому что жаждешь внимания, а потому что признание — это сигнал “да” от мира.",
        "C": "Ты опираешься на внутреннюю правду. Даже если никто не видит — ты идёшь, если чувствуешь «это моё». Ты сама себе ценность, сама себе подтверждение.",
        "D": "Твоя энергия включается, когда масштаб велик. Ты не про малое. Ты чувствуешь: если это больше, чем я — я нужна этому. И ты входишь. Без страха. Из силы."
    }
},
{
    "id": "vasini_32",
    "text": "Как ты реагируешь, когда видишь, что кто-то делает “лучше”?",
    "type": "choice",
    "options": {
        "A": "Я вдохновляюсь и учусь",
        "B": "Я чувствую вызов и включаюсь",
        "C": "Я переключаюсь на свой путь",
        "D": "Иногда тревожусь, но быстро восстанавливаюсь"
    },
    "interpretations": {
        "A": "Ты — исследователька чужого успеха. Ты не завидуешь — ты извлекаешь суть, перенастраиваешься, учишься. У тебя нет войны — у тебя мастерская.",
        "B": "У тебя активируется драйв. Если кто-то лучше — ты не сдаёшься. Ты включаешь фокус, усиливаешь ритм. Это здоровая конкуренция, если в балансе.",
        "C": "У тебя встроен анти-сравнительный фильтр. Ты возвращаешься к себе, потому что сравнение сбивает твой путь. Ты не против других — ты про свой вектор.",
        "D": "Ты улавливаешь тревожность, но умеешь разрядить. Иногда сносит. Но ты знаешь, как себя вернуть. Сравнение — это волна. А ты — не волна. Ты — берег."
    }
},
{
    "id": "vasini_33",
    "text": "Как ты реагируешь, когда оказываешься в ситуации, где нужно “прогнуться”?",
    "type": "choice",
    "options": {
        "A": "Я не предаю себя, даже если это неудобно",
        "B": "Подстраиваюсь, если ситуация требует гибкости",
        "C": "Теряю себя, если долго не могу быть настоящей",
        "D": "Маскируюсь, но сохраняю ядро"
    },
    "interpretations": {
        "A": "Ты — вертикаль. Если что-то идёт против твоей правды — ты не идёшь. Даже если теряешь, даже если больно. Это не гордыня — это костяк.",
        "B": "Ты — вода, не камень. Ты умеешь настраиваться на форму, не теряя сути. Это не подчинение — это навигация. Твоя гибкость — сила, если от сердца.",
        "C": "Ты — живой компас. Если долго быть не собой — ты распадаешься. Тебе важно быть в зоне правды. Без неё ты теряешь голос и свет.",
        "D": "Ты — мастер стратегии. Ты можешь надеть маску, если нужно, но ядро не тронешь. Ты как бы говоришь миру: «я в системе — но не система во мне»."
    }
},
{
    "id": "vasini_34",
    "text": "Как ты воплощаешь то, что видишь в будущем?",
    "type": "choice",
    "options": {
        "A": "Создаю архитектуру, перевожу образы в систему",
        "B": "Долго ношу в себе, а потом даю форму",
        "C": "Стартую и передаю другим на реализацию",
        "D": "Начинаю, но иногда отстаю от масштаба своего же замысла"
    },
    "interpretations": {
        "A": "Ты архитекторка образов. Ты не просто видишь — ты создаёшь структуру. Ты способна переводить нефизическое в логичное. Это не просто реализация — это материализация.",
        "B": "Ты инкубаторка смыслов. Ты долго носишь, переплавляешь, вынашиваешь. Твоё не рождается быстро, но когда приходит — оно цельно.",
        "C": "Ты визионерка-сборщица. Ты не обязана всё делать сама. Ты создаёшь импульс — а реализация идёт через команду, сообщество, поле. Это не слабость. Это стратегия создательницы.",
        "D": "Ты — небесная скорость в земном теле. Иногда то, что ты видишь, не укладывается в текущий ресурс. Это не ошибка. Это приглашение собрать платформу под свой космос."
    }
},
    # Добавьте остальные вопросы из test2.0 здесь
]

# Функции для получения вопросов
def get_demo_questions() -> List[Dict[str, Union[str, List[str]]]]:
    """
    Получение списка демо-вопросов.
    
    Returns:
        List[Dict]: Список демо-вопросов.
    """
    return DEMO_QUESTIONS

def get_all_vasini_questions() -> List[Dict[str, Union[str, Dict[str, str]]]]:
    """
    Получение полного списка вопросов Vasini.
    
    Returns:
        List[Dict]: Полный список вопросов Vasini.
    """
    return VASINI_QUESTIONS

def get_question_by_id(question_id: str) -> Dict[str, Union[str, Dict[str, str]]]:
    """
    Получение вопроса по его ID.
    
    Args:
        question_id: ID вопроса.
        
    Returns:
        Dict: Данные вопроса или пустой словарь, если вопрос не найден.
    """
    # Объединяем демо-вопросы и все вопросы Vasini
    all_questions = DEMO_QUESTIONS + get_all_vasini_questions()
    
    # Ищем вопрос по ID
    for question in all_questions:
        if question["id"] == question_id:
            return question
    
    # Если вопрос не найден, возвращаем пустой словарь
    return {}

def get_personality_type_from_answers(answers: Dict[str, Any]) -> Tuple[Dict[str, int], str, Optional[str]]:
    """
    Определяет тип личности по ответам на вопросы Vasini.
    
    Args:
        answers: Словарь с ответами пользователя
    
    Returns:
        Tuple[Dict[str, int], str, Optional[str]]: Кортеж с количеством ответов каждого типа, 
                                              основным типом личности и дополнительным типом (если есть)
    """
    # Счетчики для типов ответов
    type_counts = {
        "A": 0,  # Аналитический тип
        "B": 0,  # Эмпатический тип
        "C": 0,  # Практический тип
        "D": 0   # Творческий тип
    }
    
    # Подсчитываем количество ответов каждого типа
    vasini_count = 0
    for question_id, answer in answers.items():
        # Проверяем, что это вопрос Vasini (начинается с 'vasini_')
        if question_id.startswith('vasini_') and answer in ["A", "B", "C", "D"]:
            type_counts[answer] += 1
            vasini_count += 1
    
    # Логируем информацию о подсчете
    logger.info(f"Подсчитано {vasini_count} ответов на вопросы Vasini")
    logger.info(f"Распределение ответов: A ({type_counts['A']}), B ({type_counts['B']}), C ({type_counts['C']}), D ({type_counts['D']})")
    
    # Если ответов на вопросы Vasini нет, возможно структура ответов другая
    # Проверяем наличие ответов в другом формате
    if sum(type_counts.values()) == 0:
        logger.warning("Не найдены ответы в стандартном формате, пробуем альтернативный формат")
        for key, value in answers.items():
            if isinstance(value, str) and value.upper() in ["A", "B", "C", "D"]:
                type_counts[value.upper()] += 1
    
    # Находим тип с наибольшим количеством ответов
    primary_type = max(type_counts, key=type_counts.get)
    max_count = type_counts[primary_type]
    
    # Если все счетчики равны 0, устанавливаем тип по умолчанию
    if max_count == 0:
        logger.warning("Не удалось определить тип личности, используется тип по умолчанию")
        return type_counts, "Аналитический тип", None
        
    # Название типа личности
    personality_types = {
        "A": "Аналитический тип",
        "B": "Эмпатический тип",
        "C": "Практический тип",
        "D": "Творческий тип"
    }
    
    # Находим второй по частоте тип
    type_counts_copy = type_counts.copy()
    type_counts_copy.pop(primary_type)
    secondary_type = max(type_counts_copy, key=type_counts_copy.get)
    second_max_count = type_counts_copy[secondary_type]
    
    # Если второй тип сильно отстает от первого, не учитываем его
    if second_max_count < max_count * 0.7:
        secondary_result = None
    else:
        secondary_result = personality_types[secondary_type]
    
    logger.info(f"Определен тип личности: {personality_types[primary_type]}" + 
               (f" с элементами {secondary_result}" if secondary_result else ""))
    
    return type_counts, personality_types[primary_type], secondary_result

def generate_profile_prompt(answers: Dict[str, str]) -> str:
    """
    Генерирует промт для создания психологического профиля по структуре 2.0.
    
    Args:
        answers: Словарь с ответами пользователя на вопросы
    
    Returns:
        str: Промт для генерации профиля
    """
    # Получаем информацию о типе личности
    type_counts, primary_type, secondary_type = get_personality_type_from_answers(answers)
    
    # Получаем базовую информацию о пользователе
    name = answers.get("name", "пользователь")
    age = answers.get("age", "")
    birthdate = answers.get("birthdate", "")
    birthplace = answers.get("birthplace", "")
    timezone = answers.get("timezone", "")
    
    # Формируем строку с личными данными пользователя
    personal_data = f"Личные данные пользователя:\n"
    personal_data += f"- Имя: {name}\n"
    
    if age:
        personal_data += f"- Возраст: {age}\n"
    if birthdate:
        personal_data += f"- Дата рождения: {birthdate}\n"
    if birthplace:
        personal_data += f"- Место рождения: {birthplace}\n"
    if timezone:
        personal_data += f"- Часовой пояс: {timezone}\n"
    
    # Формируем промт на основе структуры профайлинга 2.0
    prompt = f"""Создай персональный профиль пользователя согласно структуре профайлинга 2.0.

{personal_data}

Информация о типе личности:
- Основной тип: {primary_type}
- Дополнительный тип: {secondary_type if secondary_type else "не выявлен"}
- Распределение ответов: A ({type_counts['A']}), B ({type_counts['B']}), C ({type_counts['C']}), D ({type_counts['D']})

Структура персонального профиля должна СТРОГО соответствовать следующим требованиям:

1. **Ядро личности (5 основных модулей)** - выбери 5 главных модулей силы на основе выборов A-D
   Для каждого из 5 модулей:
   - **Название модуля** (8-24 символа)
   - **Описание модуля** (180-230 символов)
   - **Как проявляется** (260-320 символов)
   - **Раскрытие** (260-320 символов)
   - **Ключ-фраза** (35-80 символов)
   Разделяй модули строкой из трёх тире `---`

2. **Вспомогательные модули (5 модулей)** - выбери 5 дополнительных модулей
   Для каждого из 5 модулей:
   - **Название модуля** (8-24 символа)
   - **Описание модуля** (140-180 символов)
   - **Как проявляется** (220-280 символов)
   - **Раскрытие** (220-280 символов)
   - **Ключ-фраза** (35-80 символов)

3. **Общий код личности** - один непрерывный абзац (420-540 символов)

4. **P.S.** - один абзац мотивации (300-400 символов)

Стиль и тон текста:
- Обращайся к пользователю исключительно на «ты», во втором лице единственного числа, женский род
- Используй поэтичный и образный язык с метафорами и ритмом
- Сохраняй ясность и конкретику, избегай "воды" и эзотерики
- Используй короткие энергичные предложения для ключевых мыслей
- Тон должен быть поддерживающим, вдохновляющим и честным
- Названия модулей выделяй жирным шрифтом с нумерацией
- Формулируй ключ-фразы в настоящем времени, от первого лица

ВАЖНО: Соблюдай точное количество символов в каждом блоке согласно указанным диапазонам. Символы считаются вместе с пробелами и знаками пунктуации.
"""
    
    return prompt